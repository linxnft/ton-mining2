# TON Mining Simulator

## Необходимые компоненты
- Node.js 18 или выше
- MongoDB 6 или выше
- Docker (опционально)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/linxnft/ton-mining2.git
cd ton-mining2
```

2. Установите зависимости:
```bash  npm install
```

3. Создайте файл с переменными окружения:
```bash cp .env.example .env
```

4. Обновите переменные окружения в файле `.env`:
- Укажите адрес вашего TON кошелька (VITE_TON_RECEIVER_ADDRESS)
- Настройте подключение к MongoDB (VITE_MONGODB_URI)
- Укажите URL вашего API (VITE_API_URL)

## Разработка

Для запуска в режиме разработки:
```bash
npm run dev
```

## Деплой на продакшн

### Используя Docker:
```bash
docker-compose up -d
```

### Ручной деплой:
1. Соберите приложение:
```bash
npm run build
```

2. Запустите через PM2:
```bash
pm2 start ecosystem.config.js
```

## Настройка сервера

1. Обновите файл `tonconnect-manifest.json`:
   - Замените `your-domain.com` на ваш домен
   - Обновите пути к иконке и документам
   - Убедитесь, что все URL используют HTTPS

2. Настройка Nginx:
   - Скопируйте конфигурацию из `nginx.conf`
   - Замените `your-domain.com` на ваш домен
   - Установите SSL сертификат через Certbot:
     ```bash
     sudo certbot --nginx -d your-domain.com
     ```

3. Настройка MongoDB:
   - Создайте пользователя с ограниченными правами
   - Настройте брандмауэр
   - Включите аутентификацию
   - Настройте регулярные бэкапы

4. Безопасность:
   - Всегда используйте HTTPS
   - Настройте файрвол (UFW)
   - Регулярно обновляйте систему
   - Настройте ограничение запросов (rate limiting)

## Мониторинг и обслуживание

### PM2 команды:
```bash
# Просмотр логов
pm2 logs

# Перезапуск приложения
pm2 restart ton-mining

# Просмотр статуса
pm2 status

# Мониторинг ресурсов
pm2 monit
```

### Бэкап MongoDB:
```bash
# Создание бэкапа
mongodump --db ton-mining --out /backup/$(date +%Y%m%d)

# Восстановление из бэкапа
mongorestore --db ton-mining /backup/20240301
```

### Проверка логов:
```bash
# Nginx логи
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log

# PM2 логи
pm2 logs ton-mining
```

## Возможные проблемы и решения

1. Ошибка подключения к MongoDB:
   - Проверьте правильность URI в .env
   - Убедитесь, что MongoDB запущена
   - Проверьте права доступа

2. Ошибки TON Connect:
   - Проверьте правильность адреса кошелька
   - Убедитесь, что manifest.json доступен по HTTPS
   - Проверьте корректность URL в манифесте

3. Nginx не проксирует запросы:
   - Проверьте конфигурацию nginx
   - Убедитесь, что приложение запущено
   - Проверьте порты и файрвол

## Обновление приложения

1. Получите последние изменения:
```bash
git pull origin main
```

2. Обновите зависимости:
```bash
npm install
```

3. Пересоберите приложение:
```bash
npm run build
```

4. Перезапустите через PM2:
```bash
pm2 restart ton-mining
```

## Контакты и поддержка

При возникновении проблем:
1. Проверьте раздел с возможными проблемами
2. Просмотрите логи приложения и сервера
3. Создайте issue в репозитории с подробным описанием проблемы